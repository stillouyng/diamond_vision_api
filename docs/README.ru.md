[üá∫üá∏ English](../README.md) |  [üá∑üá∫ –†—É—Å—Å–∫–∏–π](README.ru.md)


# Diamond Vision API

[![Workflow](https://github.com/stillouyng/diamond_vision_api/actions/workflows/workflow.yml/badge.svg)](https://github.com/stillouyng/diamond_vision_api/actions/workflows/workflow.yml)

### Stack
Poetry, FastAPI, httpx, SQLAlchemy 2.0, pydantic, Alembic, pytest, Flake8, n8n  


### Spam Checker
–°–∞–π—Ç spam-checker –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ—ç—Ç–æ–º—É —è –¥–æ–±–∞–≤–∏–ª –º–∞–ª–µ–Ω—å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É. 

–î–ª—è –ª—É—á—à–µ–π –ø—Ä–∞–∫—Ç–∏–∫–∏, –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–ø–∞–º –¥–æ–ª–∂–Ω–∞ –±—ã–ª–∞ –±—ã—Ç—å –∫–∞–∫ middleware,
–Ω–æ, —è –ø–æ–¥—É–º–∞–ª, —á—Ç–æ —ç—Ç–æ –±—É–¥–µ—Ç —á–µ—Ä–µ—Å—á—É—Ä.

–í—ã –º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä—è–º–æ –≤ –∫–æ–¥–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞: [–∑–¥–µ—Å—å](../src/api/routers/complaints.py),
–ö–æ–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –≤ –ø–∞–º—è—Ç–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø—Ä–∞–≤–∏–ª–∞:

`–û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –Ω–µ —á–∞—â–µ, —á–µ–º —Ä–∞–∑ –≤ 10 —Å–µ–∫—É–Ω–¥.`

### How It Works

–í —Ç–µ–∫—É—â–µ–π –∏–Ω—Å—Ç–∞–Ω—Ü–∏–∏, —Å–∞–π—Ç —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ —Å–∞–π—Ç–µ [Render](https://diamond-vision-api.onrender.com),
–±–µ–∑ –¥–æ–º–∞—à–Ω–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã :)

–¢–∞–∫ –∂–µ, –ø—Ä–æ—à—É —É—á–µ—Å—Ç—å, —á—Ç–æ —Å–∞–π—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ –º–∏–Ω—É—Ç—ã –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.

–ù–∞—Å—á–µ—Ç n8n, –µ—Å—Ç—å –Ω–µ–±–æ–ª—å—à–∞—è –ø—Ä–æ–±–ª–µ–º–∞. –í—ã –º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫ n8n –≤ –ø–∞–ø–∫–µ [pictures](../pictures).
–Ø –∑–∞–±—ã–ª –æ —Ç–æ–º, —á—Ç–æ –æ–Ω–ª–∞–π–Ω –≤–µ—Ä—Å–∏—è n8n –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å credentials.json –æ—Ç Google :(

### IP Info by API
–Ø –ø–æ–ª—É—á–∞—é –¥–∞–Ω–Ω—ã–µ –∏–∑ [ip-api](https://ip-api.com),
–Ω–æ, —á–µ—Å—Ç–Ω–æ –≥–æ–≤–æ—Ä—è, —è –Ω–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª –∑–∞—á–µ–º.
–ü—Ä—è–º–æ —Å–µ–π—á–∞—Å –¥–∞–Ω–Ω—ã–µ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `LOG_FILE`.


### Environment file

–°–æ–∑–¥–∞–π—Ç–µ –≤–∞—à `.env` —Ñ–∞–π–ª, –∏—Å–ø–æ–ª—å–∑—É—è —à–∞–±–ª–æ–Ω [.env.example](../src/.env.example)


### Quickstart

1. –°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª.
2. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—É—Ç—å: `./instance/database.sqlite`.
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: 
```bash 
  poetry install
```
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä.
```bash
  poetry run uvicorn src.main:app
```

### ‚ö†Ô∏è Don't Forget!

- **env.py** - –£–¥–æ—Å—Ç–æ–≤–µ—Ä—å—Ç–µ—Å—å —á—Ç–æ –≤—ã –∑–∞–¥–∞–ª–∏ –ø—É—Ç—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:
```python
# Look for this line and change it:
sqlalchemy.url = your_database_url_here
```
- **alembic.ini** - –ù–µ –∑–∞–±—É–¥—å—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —ç—Ç–æ—Ç –ø—É—Ç—å —Ç–æ–∂–µ:
```ini
[alembic]
sqlalchemy.url = your_database_url_here
```

### AI to classify the category

–Ø –∏—Å–ø–æ–ª—å–∑—É—é [Open Router](https://openrouter.ai) c –ò–ò Mistral-7B-v0.3.

### Request example

–°—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–≤–∞ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø—É—Ç–∏ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞:
```text
    local_base_url = "http://127.0.0.1:8000/api/v1/complaints"
    router_base_url = "https://diamond-vision-api.onrender.com/api/v1/complaints"
```
- –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∂–∞–ª–æ–±—É
```bash
    curl -X POST {{ base_url }} /add \
         -H "Content-Type: application/json" \
         -d '{"text": "Complaint"}'
         -o response.json
```
- –û–±–Ω–æ–≤–∏—Ç—å –∂–∞–ª–æ–±—É
```bash
    curl -X PATCH {{ base_url }} /update_complaint \
         -H "Content-Type: application/json" \
         -d '{"id": 1, *filters}'
         -o response_update.json
```
- –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–µ –∂–∞–ª–æ–±—ã (–° —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–æ–º "–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å")
```bash
    curl -X GET {{ base_url }} /get_new_complaints \
         -H "Content-Type: application/json" \
         -o response_list.json
```


### Responses
- 201 Created:
```json
{
  "id": 1,
  "text": "Complaint",
  "status": "open",
  "created_at": "2025-07-13T12:00:00",
  "sentiment": "neutral"
}
```
- 422 Validate Error:
```json
{
  "message": "Validate error.",
  "details": "Validated fields description."
}
```
- 429 Too Many Requests:
```json
{
  "message": "Too many requests.",
  "details": "Try again In <sec_last> seconds later."
}
```
- 500 Internal Server Error:
```json
{
  "message": "<Error Type>",
  "details": "<Error Description>"
}
```